schema: ajax.provider_policy.v1

defaults:
  # Cooldowns (seconds) aplicados cuando ledger detecta soft_fail.
  cooldowns:
    quota_exhausted: 1800
    429_tpm: 1800
    timeout: 600
    bridge_error: 20
  # Probe-fail policy: evita bucles de retry cuando un bridge cae repetidamente.
  probe_failures_threshold: 2
  probe_failures_cooldown_seconds: 900
  # Guardas de coste: prefijos que se excluyen en cost_mode=save_codex.
  save_codex_exclude_prefixes: [codex_]

rails:
  prod:
    roles:
      brain:
        # Premium-first: codex -> qwen -> groq -> gemini (local solo con override).
        preference: [codex_brain, qwen_cloud, groq, gemini_cli]
      council:
        # Premium-first: codex -> gemini -> qwen -> groq (local solo con override).
        preference: [codex_brain, gemini_cli, qwen_cloud, groq]
      scout:
        preference: [gemini_cli, qwen_cloud, groq]
      vision:
        # Vision: Gemini CLI como primera opci√≥n.
        preference: [gemini_cli, codex_brain, qwen_cloud, groq]

  lab:
    roles:
      brain:
        preference: [codex_brain, qwen_cloud, groq, gemini_cli]
      council:
        preference: [codex_brain, gemini_cli, qwen_cloud, groq]
      scout:
        preference: [qwen_cloud, gemini_cli, groq]
      vision:
        preference: [gemini_cli, codex_brain, qwen_cloud, groq]

providers:
  lmstudio:
    cost_class: free
    policy_state_text: disallowed
  lmstudio_vision:
    cost_class: free
    policy_state_text: disallowed
    policy_state_vision: allowed
  groq:
    cost_class: paid
  qwen_cloud:
    cost_class: generous
    rate_limits:
      source: manual_policy
      status: known_opaque_provider
      limits:
        rpm: 30
        tpm: 60000
      note: "Conservative defaults; update if official docs appear."
  gemini_cli:
    cost_class: generous
  codex_brain:
    cost_class: paid
